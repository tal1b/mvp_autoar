{% extends "base.html" %}

{% block title %}Employees - Employee Management System{% endblock %}

{% block content %}
<div class="page-header">
    <h2>üë• Employee List</h2>
    {% if is_manager %}
    <div>
        <a href="{{ url_for('export_data', data_type='employees', format='csv') }}" class="btn btn-secondary">Export CSV</a>
        <a href="{{ url_for('export_data', data_type='employees', format='excel') }}" class="btn btn-secondary">Export Excel</a>
    </div>
    {% endif %}
</div>

<div class="filters">
    <form method="GET" action="{{ url_for('employees') }}" class="filter-form">
        <div class="form-group">
            <input type="text" name="search" placeholder="Search by name or position..." 
                   value="{{ search }}" class="form-control">
        </div>
        <div class="form-group">
            <select name="department" class="form-control">
                <option value="">All Departments</option>
                {% for dept in departments %}
                <option value="{{ dept.department }}" {% if department_filter == dept.department %}selected{% endif %}>
                    {{ dept.department }}
                </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
        <a href="{{ url_for('employees') }}" class="btn btn-secondary">Reset</a>
    </form>
</div>

{% if employees %}
<div class="table-container">
    <table class="employees-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Full Name</th>
                <th>Position</th>
                <th>Department</th>
                <th>Role</th>
                <th>Start Date</th>
                <th>Email</th>
                <th>Phone</th>
                {% if is_manager %}
                <th>Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for employee in employees %}
            <tr>
                <td>{{ employee.id }}</td>
                <td>{{ employee.full_name }}</td>
                <td>{{ employee.position }}</td>
                <td>{{ employee.department }}</td>
                <td>
                    {% if employee.role == 'manager' %}
                        <span class="role-badge role-manager">üëî Manager</span>
                    {% elif employee.role == 'employee' %}
                        <span class="role-badge role-employee">üë§ Employee</span>
                    {% else %}
                        <span class="role-badge">‚Äî</span>
                    {% endif %}
                </td>
                <td>{{ employee.start_date }}</td>
                <td>{{ employee.email or '-' }}</td>
                <td>{{ employee.phone or '-' }}</td>
                {% if is_manager %}
                <td class="actions">
                    <a href="{{ url_for('edit_employee', employee_id=employee.id) }}" class="btn btn-sm btn-edit">‚úèÔ∏è Edit</a>
                    <button onclick="deleteEmployee({{ employee.id }})" class="btn btn-sm btn-delete">üóëÔ∏è Delete</button>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <p>üë• No employees found.</p>
    <p class="empty-hint">Employees will appear after registration with "Employee" role</p>
</div>
{% endif %}

<script>
function deleteEmployee(id) {
    if (confirm('‚ö†Ô∏è WARNING!\n\nAre you sure you want to delete this employee?\n\nThis action will delete:\n- Employee data\n- All their tasks\n- All their salaries\n- All their shifts\n- User account\n\nThis action cannot be undone!')) {
        fetch(`/employee/delete/${id}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ ' + data.message);
                location.reload();
            } else {
                alert('‚ùå ' + (data.message || 'Error deleting employee'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('‚ùå Error deleting employee');
        });
    }
}
</script>
{% endblock %}
